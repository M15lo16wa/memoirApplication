<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test 2FA QR Code</title>
    <script src="https://unpkg.com/qrcode@1.5.4/build/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .qr-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .secret-display {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 20px 0;
            word-break: break-all;
        }

        .info-box {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üß™ Test Affichage QR Code 2FA</h1>

        <div class="info-box">
            <h3>üìã Donn√©es simul√©es du serveur :</h3>
            <p><strong>Status:</strong> requires2FA</p>
            <p><strong>Secret 2FA:</strong> FEJVAD3TL46H4J2T</p>
            <p><strong>ID Patient:</strong> 5</p>
            <p><strong>Nom:</strong> MOLOWA ESSONGA</p>
            <p><strong>Num√©ro d'assur√©:</strong> TEMP000005</p>
        </div>

        <div class="qr-container">
            <h3>üì± QR Code g√©n√©r√© :</h3>
            <div id="qrcode"></div>
            <p><em>Scannez ce QR code avec Google Authenticator ou une app similaire</em></p>
        </div>

        <div class="secret-display">
            <h4>üîë Secret TOTP :</h4>
            <p id="secret-display"></p>
        </div>

        <div class="info-box">
            <h3>üì± Instructions :</h3>
            <ol>
                <li>T√©l√©chargez Google Authenticator sur votre t√©l√©phone</li>
                <li>Scannez le QR code ci-dessus</li>
                <li>V√©rifiez que l'application affiche "Sant√© S√©n√©gal"</li>
                <li>Le code √† 6 chiffres change toutes les 30 secondes</li>
            </ol>
        </div>
    </div>

    <script>
        // Donn√©es simul√©es du serveur
        const userData = {
            id_patient: 5,
            nom: 'MOLOWA',
            prenom: 'ESSONGA',
            numero_assure: 'TEMP000005',
            two_factor_enabled: true,
            two_factor_secret: 'FEJVAD3TL46H4J2T'
        };

        // G√©n√©rer l'URL TOTP
        const appName = 'Sant√© S√©n√©gal';
        const userName = userData.numero_assure;
        const secret = userData.two_factor_secret;

        const qrCodeUrl = `otpauth://totp/${appName}:${userName}?secret=${secret}&issuer=${appName}&algorithm=SHA1&digits=6&period=30`;

        // Afficher le QR code
        QRCode.toCanvas(document.getElementById('qrcode'), qrCodeUrl, {
            width: 200,
            margin: 2,
            color: {
                dark: '#000000',
                light: '#FFFFFF'
            }
        }, function (error) {
            if (error) console.error(error);
            console.log('QR Code g√©n√©r√© avec succ√®s !');
        });

        // Afficher le secret
        document.getElementById('secret-display').textContent = secret;

        console.log('URL TOTP g√©n√©r√©e:', qrCodeUrl);
        console.log('Donn√©es utilisateur:', userData);
    </script>
</body>

</html>